# -*- coding: utf-8 -*-
# Generated by Django 1.9.7 on 2016-07-16 22:26
from __future__ import unicode_literals
from django.db import migrations

from project.migration_utils import FixtureDataMigration


class Counties:
    CONTRA_COSTA = 'contracosta'
    SAN_FRANCISCO = 'sanfrancisco'
    ALAMEDA = 'alameda'
    MONTEREY = 'monterey'
    SOLANO = 'solano'
    SAN_DIEGO = 'san_diego'
    SAN_JOAQUIN = 'san_joaquin'
    SANTA_CLARA = 'santa_clara'
    SANTA_CRUZ = 'santa_cruz'
    FRESNO = 'fresno'
    SONOMA = 'sonoma'
    TULARE = 'tulare'
    VENTURA = 'ventura'
    SANTA_BARBARA = 'santa_barbara'
    YOLO = 'yolo'
    STANISLAUS = 'stanislaus'
    OTHER = 'other'


class AddDefaultCounties(FixtureDataMigration):
    fixture_specs = [
        ('intake', 'County', '0015_add_default_counties_data.json')
    ]

    @classmethod
    def forward(cls, *args):
        super().forward(*args)
        County = cls.get_model_class('intake', 'County', *args)
        FormSubmission = cls.get_model_class('intake', 'FormSubmission', *args)
        sf_county = County.filter(slug=Counties.SAN_FRANCISCO).first()
        for submission in FormSubmission.all():
            if submission.counties.count() < 1:
                submission.counties.add(sf_county)

    @classmethod
    def reverse(cls, *args):
        """just clears the 'county' m2m field on each submission
        """
        super().reverse(*args)


class Migration(migrations.Migration):

    dependencies = [
        ('intake', '0014_county_name'),
        ('user_accounts', '0006_add_county_model'),
    ]

    operations = [
        migrations.RunPython(
            AddDefaultCounties.forward,
            AddDefaultCounties.reverse)
    ]
